import*as e from"@wordpress/interactivity";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const o=(s={getContext:()=>e.getContext,store:()=>e.store,useEffect:()=>e.useEffect,useState:()=>e.useState},c={},t.d(c,s),c),n=e=>{const t=document.querySelector(".site-main h1")?.innerText||document.title;let o=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});const{tableType:n,thinkTank:r,donor:l,donationYear:s,donorType:c,search:d,searchLabel:i,ajaxUrl:p,action:b,nonce:u,pageLength:y}=a;return new DataTable(e,{retrieve:!0,api:!0,autoWidth:!1,processing:!0,layout:{topEnd:{search:{placeholder:"Enter keyword...",text:a.searchLabel||"Search",processing:!0,menu:[25,50,75,100]}},topStart:{buttons:[{extend:"csvHtml5",title:t,text:"Download Data",exportOptions:{columns:":visible:not(.noExport)"}}],info:{callback:function(e,t,o,n,a,r){return`${n} Records Found`}}},bottomStart:!1,bottomEnd:{paging:{type:"simple_numbers"}}},render:{currency:function(e,t,n){return o.format(e)},number:function(e,t,o){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"'")}},drawCallback:function(e){},initComplete:function(e,t){},headerCallback:function(e,t,o,n,a){},footerCallback:function(e,t,o,n,a){}})},{state:a,actions:r,callbacks:l}=(0,o.store)("ttft/data-tables",{state:{isLoading:!1,donationYear:"all",donorType:"all",entityType:"think_tank"},actions:{async renderTable(){const e=(0,o.getContext)();try{const{tableType:t,thinkTank:o,donor:r,donationYear:l,donorType:s,search:c,searchLabel:d,ajaxUrl:i,action:p,nonce:b}=a,u=new FormData;u.append("action",p),u.append("nonce",b),u.append("table_type",t),u.append("search_label",d||"Search"),u.append("donation_year",l||"all"),u.append("donor_type",s||"all"),u.append("think_tank",o),u.append("donor",r),u.append("search",c||""),console.log("formData: ",u),a.isLoading=!0,e.isLoaded=!1;const y=await fetch(i,{method:"POST",body:u}),g=await y.text();if(console.log("responseText: ",g),!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const h=JSON.parse(g);if(h.success){a.tableData=h.data;const e=document.getElementById(a.elementId);e&&(e.innerHTML=h.data,a.table&&(a.table.clear(),a.table=n(`#${a.tableId}`)))}else console.error("Error fetching table data:",h.data)}catch(e){console.error("catch( event ) renderTable:",e)}finally{a.isLoading=!1,e.isLoaded=!0}},initTable:()=>{a.table=n(`#${a.tableId}`)},destroyTable:()=>{a.table.clear().draw(),a.table.destroy()},destroyTableAsync:()=>new Promise((e=>{r.destroyTable(),e()})),setContext:()=>{const e=(0,o.getContext)();e.searchLabel&&(e.searchLabel=a.searchLabel)},generateSkeletonTable:e=>{let t="";for(let o=0;o<10;o++){t+='<tr class="row skeleton-row" width="100%">';for(let o=0;o<e;o++)t+='<td class="cell skeleton-cell"><div class="loader"></div></td>';t+="</tr>"}return t}},callbacks:{renderTable:()=>{const e=(()=>{const[e,t]=(0,o.useState)(a.donorType),[n,r]=(0,o.useState)(a.donationYear),l=()=>e!==a.donorType||n!==a.donationYear;return(0,o.useEffect)((()=>{l()&&(t(a.donorType),r(a.donationYear))}),[a.donorType,a.donationYear]),l()})();(0,o.useEffect)((()=>{e&&r.renderTable()}))},loadAnimation:()=>{(0,o.useEffect)((()=>{const e=document.getElementById(a.elementId);if(a.isLoading&&e){const t=e.querySelectorAll("thead th").length,o=r.generateSkeletonTable(t),n=e.querySelector("tbody");n&&(n.innerHTML=o)}}),[a.isLoading])},initLog:()=>{},logTable:()=>{const{tableType:e,thinkTank:t,donor:o,donationYear:n,donorType:r,search:l,isLoading:s}=a;console.log("State: ",e,t,o,n,r,s)},logState:e=>{console.log("key: ",a.key)},logLoading:()=>{const e=(0,o.getContext)();console.log("IS LOADING: ",a.isLoading,e.isLoaded)}}});var s,c;