import*as e from"@wordpress/interactivity";var t={d:(e,o)=>{for(var a in o)t.o(o,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const o=(s={getContext:()=>e.getContext,store:()=>e.store,useEffect:()=>e.useEffect,useState:()=>e.useState},c={},t.d(c,s),c),a=e=>{const t=document.querySelector(".site-main h1")?.innerText||document.title;let o=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});const{tableType:a,thinkTank:r,donor:l,donationYear:s,donorType:c,search:d,searchLabel:i,ajaxUrl:p,action:b,nonce:y,pageLength:u}=n;return new DataTable(e,{retrieve:!0,api:!0,autoWidth:!1,processing:!0,layout:{topEnd:{search:{placeholder:"Enter keyword...",text:n.searchLabel||"Search",processing:!0}},topStart:{buttons:[{extend:"csvHtml5",title:t,text:"Download Data",exportOptions:{columns:":visible:not(.noExport)"}}],info:{callback:function(e,t,o,a,n,r){return`${a} Records Found`}}},bottomStart:!1,bottomEnd:{paging:{type:"simple_numbers"}}},render:{currency:function(e,t,a){return o.format(e)},number:function(e,t,o){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"'")}},drawCallback:function(e){},initComplete:function(e,t){},headerCallback:function(e,t,o,a,n){},footerCallback:function(e,t,o,a,n){}})},{state:n,actions:r,callbacks:l}=(0,o.store)("ttft/data-tables",{state:{isLoading:!1,donationYear:"all",donorType:"all",entityType:"think_tank"},actions:{async renderTable(){const e=(0,o.getContext)();try{const{tableType:t,thinkTank:o,donor:l,donationYear:s,donorType:c,search:d,searchLabel:i,ajaxUrl:p,action:b,nonce:y}=n,u=new FormData;u.append("action",b),u.append("nonce",y),u.append("table_type",t),u.append("search_label",i||"Search"),u.append("donation_year",s||"all"),u.append("donor_type",c||"all"),u.append("think_tank",o),u.append("donor",l),u.append("search",d||""),console.log("formData: ",u),n.isLoading=!0,e.isLoaded=!1;const g=await fetch(p,{method:"POST",body:u}),h=await g.text();if(console.log("responseText: ",h),!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const T=JSON.parse(h);if(T.success){n.tableData=T.data,await r.destroyTableAsync();const e=document.getElementById(n.elementId);e&&(e.innerHTML=T.data,n.table&&(n.table=a(`#${n.tableId}`)))}else console.error("Error fetching table data:",T.data)}catch(e){console.error("catch( event ) renderTable:",e)}finally{n.isLoading=!1,e.isLoaded=!0}},initTable:()=>{n.table=a(`#${n.tableId}`)},destroyTable:()=>{n.table.clear().draw(),n.table.destroy()},destroyTableAsync:()=>new Promise((e=>{r.destroyTable(),e()})),setContext:()=>{const e=(0,o.getContext)();e.searchLabel&&(e.searchLabel=n.searchLabel)},generateSkeletonTable:e=>{let t="";for(let o=0;o<10;o++){t+='<tr class="row skeleton-row" width="100%">';for(let o=0;o<e;o++)t+='<td class="cell skeleton-cell"><div class="loader"></div></td>';t+="</tr>"}return t}},callbacks:{renderTable:()=>{const e=(()=>{const[e,t]=(0,o.useState)(n.donorType),[a,r]=(0,o.useState)(n.donationYear),l=()=>e!==n.donorType||a!==n.donationYear;return(0,o.useEffect)((()=>{l()&&(t(n.donorType),r(n.donationYear))}),[n.donorType,n.donationYear]),l()})();(0,o.useEffect)((()=>{e&&r.renderTable()}))},loadAnimation:()=>{(0,o.useEffect)((()=>{const e=document.getElementById(n.elementId);if(n.isLoading&&e){const t=e.querySelectorAll("thead th").length,o=r.generateSkeletonTable(t),a=e.querySelector("tbody");a&&(a.innerHTML=o)}}),[n.isLoading])},initLog:()=>{},logTable:()=>{const{tableType:e,thinkTank:t,donor:o,donationYear:a,donorType:r,search:l,isLoading:s}=n;console.log("State: ",e,t,o,a,r,s)},logState:e=>{console.log("key: ",n.key)},logLoading:()=>{const e=(0,o.getContext)();console.log("IS LOADING: ",n.isLoading,e.isLoaded)}}});var s,c;