import*as e from"@wordpress/interactivity";var t={d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const a=(s={getContext:()=>e.getContext,store:()=>e.store,useEffect:()=>e.useEffect,useState:()=>e.useState},d={},t.d(d,s),d),o=e=>{const t=document.querySelector(".site-main h1")?.innerText||document.title;return n.pageLength,new DataTable(e,{pageLength:25,retrieve:!0,api:!0,layout:{bottomStart:{info:{callback:function(e,t,a,o,n,r){return""}}},bottomEnd:{paging:{type:"simple_numbers"},info:{callback:function(e,t,a,o,n,r){return`${o} Records Found.`}}},topEnd:{search:{placeholder:"Enter keyword...",text:n.searchLabel||"Search"}},topStart:{buttons:[{extend:"csvHtml5",title:t,text:"Download Data"}]}},footerCallback:function(e,t,a,o,n){}})},{state:n,actions:r,callbacks:l}=(0,a.store)("ttft/data-tables",{state:{isLoading:!1,pageLength:50,donationYear:"all",donorType:"all",entityType:"think_tank"},actions:{async renderTable(){const e=(0,a.getContext)();try{const{tableType:t,thinkTank:a,donor:l,donationYear:s,donorType:d,search:c,searchLabel:i,ajaxUrl:p,action:b,nonce:y}=n,g=new FormData;g.append("action",b),g.append("nonce",y),g.append("table_type",t),g.append("search_label",i||"Search"),g.append("donation_year",s||"all"),g.append("donor_type",d||"all"),g.append("think_tank",a),g.append("donor",l),g.append("search",c||""),console.log("formData: ",g),n.isLoading=!0,e.isLoaded=!1;const h=await fetch(p,{method:"POST",body:g}),u=await h.text();if(console.log("responseText: ",u),!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const T=JSON.parse(u);if(T.success){n.tableData=T.data,await r.destroyTableAsync();const e=document.getElementById(n.elementId);e&&(e.innerHTML=T.data,n.table&&(n.table=o(`#${n.tableId}`)))}else console.error("Error fetching table data:",T.data)}catch(e){console.error("catch( event ) renderTable:",e)}finally{n.isLoading=!1,e.isLoaded=!0}},initTable:()=>{n.table=o(`#${n.tableId}`)},destroyTable:()=>{n.table.clear().draw(),n.table.destroy()},destroyTableAsync:()=>new Promise((e=>{r.destroyTable(),e()})),setContext:()=>{const e=(0,a.getContext)();e.searchLabel&&(e.searchLabel=n.searchLabel)},generateSkeletonTable:e=>{let t="";for(let a=0;a<10;a++){t+='<tr class="row skeleton-row" width="100%">';for(let a=0;a<e;a++)t+='<td class="cell skeleton-cell"><div class="loader"></div></td>';t+="</tr>"}return t}},callbacks:{renderTable:()=>{const e=(()=>{const[e,t]=(0,a.useState)(n.donorType),[o,r]=(0,a.useState)(n.donationYear),l=()=>e!==n.donorType||o!==n.donationYear;return(0,a.useEffect)((()=>{l()&&(t(n.donorType),r(n.donationYear))}),[n.donorType,n.donationYear]),l()})();(0,a.useEffect)((()=>{e&&r.renderTable()}))},loadAnimation:()=>{(0,a.useEffect)((()=>{const e=document.getElementById(n.elementId);if(n.isLoading&&e){const t=e.querySelectorAll("thead th").length,a=r.generateSkeletonTable(t),o=e.querySelector("tbody");o&&(o.innerHTML=a)}}),[n.isLoading])},initLog:()=>{},logTable:()=>{const{tableType:e,thinkTank:t,donor:a,donationYear:o,donorType:r,search:l,isLoading:s}=n;console.log("State: ",e,t,a,o,r,s)},logState:e=>{console.log("key: ",n.key)},logLoading:()=>{const e=(0,a.getContext)();console.log("IS LOADING: ",n.isLoading,e.isLoaded)}}});var s,d;